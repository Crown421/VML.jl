
using CpuId
using Libdl

## this lets us load CpuId only once 

if cpufeature(:AVX2)
    lib = :libmkl_vml_avx2
    println("AVX2 support detected, vml_avx2 selected")
else
    lib = :libmkl_vml_avx
    println("AVX2 support missing, vml_avx selected")
end

rtlib = :libmkl_rt
corelib = :libmkl_core


depsjl_path = joinpath(@__DIR__, "deps.jl")
open(depsjl_path, "w") do depsjl_file
    println(depsjl_file, strip("""
        ## This file was autogenerated by build.jl.
        ## Do not edit.
        import Libdl

        const lib = :$lib
        const rtlib = :$rtlib
        const corelib = :$corelib
        """))
end